---
title: 点云配准：从FPFH到PointNetLK、GeoTransformer
date: 2025-03-26
---


点云配准任务定义很明确：

给定两片存在部分重叠的三维点云（Source: $\mathcal{P} = {p_i}{i=1}^N$，Target: $\mathcal{Q} = {q_j}{j=1}^M$），寻找一个刚性变换参数 $T = (R, t) \in SE(3)$，使得变换后的 $\mathcal{P}'=T(\mathcal{P})$ 与 $\mathcal{Q}$ 在重叠区域达到最佳对齐。数学上可表述为最小化对齐误差：

$$

\min_{R,t} \sum_{(p,q) \in \mathcal{C}} \|Rp + t - q\|^2

$$

其中 $\mathcal{C}$ 为两片点云之间的对应点对集合。

与二维图像配准的差异：点云的离散、无序特性使其难以直接继承图像的规则卷积操作，且三维刚性变换的自由度（旋转3维+平移3维）远超二维图像（旋转1维+平移2维）。此外，点云配准更依赖几何结构而非纹理信息，传感器噪声表现为点的位置偏移而非光照失真。

大多数配准算法的本质是"先建立对应关系，再求解最优变换"。然而，点云的稀疏性和噪声使对应点对的构建充满不确定性——错误的对应关系（外点）会直接污染变换估计。这种两阶段思路看似简单，实则暗藏玄机：若直接在原始点云上搜索最近邻点作为对应（如经典ICP算法），本质上是一个"鸡生蛋还是蛋生鸡"的问题。

以ICP为例，其迭代过程可概括为：

- 最近邻匹配：假设当前变换矩阵$T_k$近似正确，为Source点云中的每个点$p_i$在Target点云中找到空间最近的$q_j$作为对应；
- 变换求解：基于这些对应点对，通过最小二乘法更新$T_{k+1}$；
- 循环迭代：直到对齐误差收敛。

但问题在于，初始位姿偏差较大时，最近邻匹配会大量失效。例如，若两片点云的初始角度偏差超过30度，最近邻点在三维空间中可能完全不属于同一物体部位，此时基于错误对应求解的$T_{k+1}$反而会放大误差，形成"一步错，步步错"的恶性循环。这就是ICP严重依赖初始位姿、容易陷入局部最优的根本原因。

因此，现代方法常采用"粗配准+细配准"的分治策略：先用鲁棒性强的全局特征（如FPFH）或深度学习模型实现粗对齐（Coarse Registration），将位姿误差缩小到ICP可处理的范围内，再通过局部优化追求精度。这种级联结构本质上是通过算法分工，破解了配准问题的病态性。

## FPFH：手工几何特征的统计建模

在深度学习兴起之前，点云配准的核心挑战是如何将无序的三维点转换为可度量的特征表示。FPFH（Fast Point Feature Histograms）的提出，本质上是通过手工设计局部几何特征的统计分布，模拟了一种"三维直觉"——它不依赖数据驱动，而是基于对点云几何特性的先验观察：相邻点的空间分布隐含着曲率、法向量等微分几何属性，这些属性在刚性变换下具有不变性。

FPFH的核心思想可拆解为三步：

局部几何参数的提取：对每个点$p_i$，计算其邻域内所有点对的相对差异（如法向量夹角、距离、坐标偏移量），形成一组基础几何描述元；
统计直方图构建：将上述连续参数离散化为多个区间，统计每个区间内参数出现的频次，最终拼接成一个33维的直方图向量（即FPFH描述子）；
特征匹配与鲁棒估计：通过比较Source和Target点云的FPFH向量，寻找相似度最高的点对作为候选对应，再结合RANSAC算法剔除外点并估计初始变换。
与深度学习的暗合之处：
尽管FPFH完全依赖人工设计，但其底层逻辑与卷积网络的局部特征提取惊人地相似——通过局部邻域（Receptive Field）的参数化描述，将原始坐标升维到高维特征空间。不同之处在于，FPFH的"卷积核"是手工定义的几何规则，而深度学习则通过数据学习滤波器权重。

FPFH的局限性：

区分度瓶颈：直方图统计丢失了空间结构信息，导致不同几何结构的点可能生成相似描述子；
密度敏感性：邻域半径的固定取值在稀疏区域会捕获不足，在密集区域则引入噪声；
级联误差：特征匹配的错误会直接传递到变换估计阶段，RANSAC的计算复杂度随外点率指数上升。
FPFH代表了传统方法中的一种优雅妥协：在缺乏大规模数据和算力的时代，通过先验知识压缩几何信息，为粗配准提供了可解释的解决方案。它的设计哲学（局部统计→全局匹配）至今仍影响着基于学习的配准模型。

PFH特征公式（论文公式1）

对于点云中任意两个点 $p$ 和 $q$，以及它们的法向量 $n,p$ ,定义以下三个角度参数：

$$
\alpha = \frac{v \cdot n_q}{\|q - p\|}, \quad

\phi = \frac{u \cdot n_p}{\|q - p\|}, \quad

\theta = arctan\left(\frac{w \cdot n_q}{u \cdot n_q}\right)

$$

其中：

$$
u = \frac{n_p}{\|n_p\|}, \quad v = \frac{q - p}{\|q - p\|}, \quad w = u \times v
$$

点 $p$ 到 $q$ 的单位方向向量 $w = u \times v$（法向量与方向向量的叉积，定义局部坐标系）符号物理意义解析：

$\alpha$: 法向量 $n_q$ 在局部坐标系 $w$ 方向上的投影，反映点 $q$ 相对于 $p$ 的高度变化（类似曲率差异）。若两点位于同一平面，$\alpha \approx 0$。

$\phi$: 法向量 $n_p$ 在两点连线方向上的投影，描述点 $p$ 的法向量倾斜度。平面区域 $\phi$ 值稳定，边缘区域变化剧烈。

$\theta$: 法向量 $n_q$ 在局部坐标系 $u$-$v$ 平面内的方位角，编码两点间法向量的相对扭转角（对旋转敏感）。

几何直觉：

- PFH：遍历点 $p$ 邻域内所有点对，计算 $(\alpha,\phi,\theta)$ 三元组并统计为直方图。

- FPFH：为加速计算，仅考虑 $p$ 与其直接邻域点的关系（而非所有邻域点对），再通过加权融合邻近点的PFH（见论文公式2）。

示例说明：
假设点 $p$ 位于圆柱面，点 $q$ 位于平面：

- $\alpha$ 会因圆柱曲率与平面法向量差异而显著非零；

- $\theta$ 会因法向量方向突变呈现大角度值；

- 这些异常值将在直方图中形成独特统计模式，成为匹配依据。

通过这种方式，FPFH将离散点的几何关系压缩为统计特征，其本质是在手工设计的低维空间中模拟局部表面变化

### PointNetLK：当深度学习遇见数值优化  

PointNetLK的核心思想直击点云配准的本质矛盾——**如何建立对刚性变换敏感的特征空间**。与传统手工特征（如FPFH）不同，它利用PointNet的全局特征提取能力，将点云映射到高维流形，再通过逆向优化求解变换参数。这种"深度学习特征+传统优化"的混合架构，开辟了配准方法的新范式。  

#### **算法骨架拆解**  

1. **特征编码器**：使用预训练的PointNet将源点云$\mathcal{P}$和目标点云$\mathcal{Q}$分别编码为全局特征向量$\Psi(\mathcal{P})$和$\Psi(\mathcal{Q})$。  
2. **特征对齐目标**：寻找变换$T$使得$\Psi(T(\mathcal{P}))$逼近$\Psi(\mathcal{Q})$，即最小化特征空间距离：  
   $$ \min_{T} \| \Psi(T(\mathcal{P})) - \Psi(\mathcal{Q}) \|_2^2 $$  
3. **迭代优化**：采用Lucas-Kanade算法的变体，通过Jacobian矩阵近似和迭代更新求解$T$：  
   $$ \Delta T = -J^{\dagger} (\Psi(T_k(\mathcal{P})) - \Psi(\mathcal{Q})) $$  
   $$ T_{k+1} = \Delta T \cdot T_k $$  
   其中$J$是特征关于变换参数的雅可比矩阵，$\dagger$表示伪逆。  

#### **关键创新洞察**  

- **全局特征对抗局部最优**：PointNet的置换不变性和全局池化使特征对局部扰动具有鲁棒性，即使初始位姿偏差较大，特征距离仍能反映整体对齐程度；  
- **微分化的优化链路**：通过可微的PointNet和数值优化框架，实现从特征差异到SE(3)参数的端到端梯度传播，摆脱了传统ICP对最近邻匹配的依赖；  
- **隐式对应建模**：特征差异最小化实际上隐式地建立了点云间的软对应关系，避免了显式匹配带来的外点干扰。  

#### **与FPFH的哲学对比** \

- **特征工程vs特征学习**：FPFH依赖人工设计的几何统计规则，而PointNetLK通过数据驱动自动捕捉对配准任务敏感的深层模式；  
- **对应显式性**：FPFH需要显式建立点对对应并筛选外点，PointNetLK通过全局特征比对隐式引导优化方向；  
- **计算瓶颈转移**：FPFH的复杂度集中在特征匹配和RANSAC，PointNetLK则通过GPU加速的前向传播和矩阵运算实现高效优化。  

#### **局限性反思**  

- **全局特征的盲区**：当点云重叠区域较小时，全局特征可能无法捕捉局部对齐信号；  
- **李代数近似误差**：使用一阶泰勒展开近似迭代更新，在大位姿偏差时线性假设失效；  
- **网络与优化的割裂**：PointNet的特征编码器通常需要预训练而非端到端优化，限制了特征空间的针对性。  

